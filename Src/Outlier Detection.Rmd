---
title: "outlier detection"
output: html_document
date: "2024-01-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Modello definitivo
```{r}
time <- data$`Effective Lifetime`
status <- data$Status

cox5bis <- coxph(Surv(time,status == 'retired') ~  Apogee + log.Eccentricity   +
                Mass + Users + strata(Purpose) + Continent + strata(Orbit), data = data)
summary(cox5bis)
```

Valori predetti (test set)
```{r}
library(coxed)
test.set <- read_excel("../Dataset/TestSet.xlsx", col_names = TRUE)
i <- which(test.set$Purpose == 'Navigation' | test.set$Orbit == 'Elliptical' | test.set$Continent == 'Africa' | test.set$Continent == 'Multinational' | test.set$Continent == 'Oceania' )
test.set <- test.set[-i,]
i <- which(test.set$Eccentricity == 0)
test.set$Eccentricity[i] = 1
test.set$log.Eccentricity <- -log(test.set$Eccentricity)

coxed <- coxed::coxed(cox5bis, newdata = test.set, method="npsf", bootstrap = TRUE, B=750)
predicted_lifetime <- coxed$exp.dur
```

Differenza tra valori predetti e Expected lifetime
```{r}
id <- which(test.set$Status == 'retired')
diff <- predicted_lifetime$exp.dur[id] - test.set$`Expected Lifetime`[id]
plot(diff)
```

OUTLIER DETECTION ON THE DIFFERENCE
```{r}
library(MASS)
#library(rgl)
library(DepthProc)
library(hexbin)
library(aplpack)
library(robustbase)
```

```{r}
bagplot_cont_normals <- bagplot(diff)
outlying_obs <- bagplot_cont_normals$pxy.outlier

#ind_outlying_obs <- which(apply(diff,1,function(x) all(x %in% outlying_obs)))
ind_outlying_obs = outlying_obs[,1] 
```
Outliers indexes: 2  4  6 30 31 50

```{r}
diff[c(2,4,6,30,31,50)]
```
The indexes 30, 31, 50 correspond to satellites which have a far longer predicted lifetime than the expected one.
The indexes 2, 4, 6 correspond to satellites which have a far shorter predicted lifetime than the expected one (-> This type of satellites are not good to rely on)

Scopriamo a quali satelliti corrispondono:
```{r}
id[ind_outlying_obs]
out_sat = test.set[id[ind_outlying_obs],]
```
- Satellites which have a far shorter predicted lifetime than the expected one (-> This type of satellites are not good to rely on):
Astra 1G	Luxembourg	Commercial	Communications	GEO	
Sicral 1A	Italy	Military	Communications	GEO	
Echostar 7	USA	Commercial	Communications	GEO	

--> meno recenti, europei/americani, GEO, commercial/military

- Satellites which have a far longer predicted lifetime than the expected one:
IGS-8B	Japan	Government	Earth Observation	LEO		
Megha-Tropiques	India	Government	Earth Observation	LEO		
STSat-2C	South Korea	Government	Technology Development	LEO	

--> pi√π recenti, asiatici, LEO, government







