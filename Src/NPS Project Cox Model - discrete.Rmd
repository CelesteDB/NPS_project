---
title: "NPS Project Cox Model - discrete"
output: html_document
date: "2023-11-30"
---

```{r}
# per lettura dataset se prendi file da github
library(readxl)
data <- read_excel("../Dataset/Data_Satellites.xlsx", col_names = TRUE)
```

Libraries:
```{r,'error=FALSE', 'warning=FALSE'}
library(readxl)
library(survival)
library(survminer)
library(dplyr) 
library(ggplot2)
library(knitr)
library(broom)
library(tidyr)
```

Summary:
```{r}
summary(data)
```
Remove Technology Development satellite:
```{r}
data <- data[-which(data$Purpose == "Technology Development"),]
```
Rendi colonne factor:
```{r}
data$Country <- factor(data$Country, ordered = F)
print('Country')
table(data$Country)

data$Continent <- factor(data$Continent, ordered = F)
print('Continent')
table(data$Continent)

data$Users <- factor(data$Users, ordered = F)
print('Users')
table(data$Users)

data$Purpose <- factor(data$Purpose, ordered = F)
print('Purpose')
table(data$Purpose)

data$Orbit <- factor(data$Orbit, ordered = F)
print('Class of Orbit')
table(data$Orbit)

data$Status <- factor(data$Status, ordered = F)
print('Status')
table(data$Status)
```

Mischia righe
```{r}
data <- data[sample(nrow(data)), ]

```
We decided to discretize Period, Apogee, Perige and eccentricity
Period:
- Low Earth Orbit (LEO): 0 - 120 minutes
- Medium Earth Orbit (MEO): 120 minutes - 1440 minutes
- Geosynchronous Orbit (GEO): above 1440 minutes

Sources:
https://en.wikipedia.org/wiki/Low_Earth_orbit
https://en.wikipedia.org/wiki/Medium_Earth_orbit
UCS Satellite Database Userâ€™s Manual 1-1-17 (pag 5)
```{r}
data$Periodcat <- cut(data$Period, breaks=c(0, 120, 1440, Inf), labels=c("LEO", "MEO", "GEO"))

```
Apogee:
We know that:
- Low Earth Orbit (LEO): Altitudine: Circa 200 a 2.000 chilometri sopra la Terra.
- Medium Earth Orbit (MEO):Altitudine: Circa 2.000 a 35.786 chilometri sopra la Terra.
- Geosynchronous Orbit (GEO): Altitudine: Varia, ma generalmente superiore a 35.786 chilometri.

```{r}
data$Apogeecat <- cut(data$Apogee, breaks=c(0, 2000, 35786, Inf), labels=c("LEO", "MEO", "GEO"))

```
Perigee:
We know that:
- Low Earth Orbit (LEO): Altitudine: Circa 200 a 2.000 chilometri sopra la Terra.
- Medium Earth Orbit (MEO):Altitudine: Circa 2.000 a 35.786 chilometri sopra la Terra.
- Geosynchronous Orbit (GEO): Altitudine: Varia, ma generalmente superiore a 35.786 chilometri.


```{r}
data$Perigeecat <- cut(data$Perigee, breaks=c(0, 2000, 35786, +Inf), labels=c("LEO", "MEO", "GEO"))

```
Eccentricity

Per le orbite circolari: e=0
Per le orbite ellittiche: 0 < e < 1

```{r}
data$Ecccat <- cut(data$Eccentricity, breaks=c(-Inf, 0, 1), labels=c("Circ", "Elip"))
```


```{r}
time <- data$'Effective Lifetime'
Status <- data$Status
# Longitude of Geo inutile
covariates <- c("Purpose", "Inclination", "Mass" ,"Periodcat", "Apogeecat","Perigeecat", "Ecccat" )
covariates <- c("Purpose", "Inclination", "Mass" ,"Orbit", "Ecccat" )

cox1 <- coxph(Surv(time, Status == 'retired') ~ . , data = data[,covariates])

summary(cox1)
```
