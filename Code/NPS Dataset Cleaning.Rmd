---
title: "NPS Dataset Cleaning"
author: "Simone Ciardulli"
date: "`r Sys.Date()`"
output: html_document
---

Set wd:
```{r}
setwd("C:/Users/simon/Desktop/Università/V Anno/I Semester/Nonparametric Statistics/Project")
```

Import data:
```{r}
library(readxl)
data <- read_excel("../Dataset/UCS-Satellite-Database-1-1-2023.xlsx", col_names = TRUE)
```

Nomi colonne:
```{r}
names(data)
```
Rimozione colonne inutili:
```{r}
columns_to_remove <- c("Name of Satellite, Alternate Names", "Country/Org of UN Registry", "Operator/Owner", "Detailed Purpose", "Type of Orbit", "Contractor", "Launch Site", "Launch Vehicle", "COSPAR Number", "NORAD Number", "Comments", "...32", "Source Used for Orbital Data", "Source...34", "Source...35", "Source...36", "Source...37", "Source...38", "Source...39", "Source...40")

data <- data[, -c(which(names(data) %in% columns_to_remove), 41:71)]

names(data)
```

Confronta "Country of Contractor" con "Country of Operator/Owner":
```{r}
ind <- which(data$`Country of Contractor` != data$`Country of Operator/Owner`)

cc <- data$`Country of Contractor`[ind]
co <- data$`Country of Operator/Owner`[ind]

df <- data.frame(co, cc)
df
```

1139 diversi, teniamo country of operator:
```{r}
data <- data[, -which(names(data) == "Country of Contractor")]
```

Summary:
```{r}
summary(data)
```


Rendi numeriche le colonne Dry mass e Longitude of GEO (sono character)
```{r}
data$`Dry Mass (kg.)` <- as.numeric(data$`Dry Mass (kg.)`)
data$`Longitude of GEO (degrees)` <- as.numeric(data$`Longitude of GEO (degrees)`)
```



Numero di NA in ogni colonna
```{r}
df <- data.frame()

for (colonna in colnames(data)) {
    conteggio_na <- sum(is.na(data[[colonna]]))
    df <- rbind(df, data.frame(Colonna = colonna, Numero_di_NA = conteggio_na))
}

df
```

Togliamo colonne launch mass(perchè teniamo dry mass) e power (6137 NA)
```{r}
columns_to_remove <- c("Power (watts)", "Launch Mass (kg.)")

data <- data[, -which(names(data) %in% columns_to_remove)]
```



Expected Lifetime (yrs.) ha 1915 NA, toglierei le righe senza questo dato
Date of Launch ha 2 NA, toglierei le righe senza questo dato
Dry Mass (kg.) ha 6278 NA, toglierei le righe senza questo dato
Period ha 45 NA, toglierei le righe senza questo dato
Inclination (degrees) ha 3 NA, toglierei le righe senza questo dato
Eccentricity ha 1 NA, toglierei le righe senza questo dato
Apogee ha 1 NA, toglierei le righe senza questo dato
Perigree ha 1 NA, toglierei le righe senza questo dato
Longitude of GEO ha 3 NA, toglierei le righe senza questo dato

```{r}
cols <- c("Expected Lifetime (yrs.)", "Date of Launch", "Dry Mass (kg.)", "Period (minutes)", "Inclination (degrees)", "Eccentricity", "Apogee (km)", "Perigee (km)", "Longitude of GEO (degrees)")

data <- data[complete.cases(data[, cols]), ]
```


Numero di NA in ogni colonna
```{r}
df <- data.frame()

for (colonna in colnames(data)) {
    conteggio_na <- sum(is.na(data[[colonna]]))
    df <- rbind(df, data.frame(Colonna = colonna, Numero_di_NA = conteggio_na))
}

df
```

Colonne sopravvissute:
```{r}
names(data)
```

Sistemare Nomi:

1) Stati

ESA/Russia -> ESA
Turkmenistan/Monaco -> Turkmenistan
United Kingdom/ESA -> United Kingdom
USA/Canada -> USA
USA/France -> USA
USA/Japan -> USA
USA/Japan/Brazil -> USA
```{r}
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "ESA/Russia")] <- "ESA"
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "Turkmenistan/Monaco")] <- "Turkmenistan"
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "United Kingdom/ESA")] <- "United Kingdom"
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "USA/Canada")] <- "USA"
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "USA/France")] <- "USA"
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "USA/Japan")] <- "USA"
data$'Country of Operator/Owner'[which(data$'Country of Operator/Owner' == "USA/Japan/Brazil")] <- "USA"
```


2) Users
"Government/Civil" -> "Government"
"Government/Commercial" -> "Government"
"Government/Commercial/Military" -> "Government"
"Military/Commercial" -> "Military"
"Military/Government" -> "Military"
```{r}
data$Users[which(data$Users == "Government/Civil")] <- "Government"
data$Users[which(data$Users == "Government/Commercial")] <- "Government"
data$Users[which(data$Users == "Government/Commercial/Military")] <- "Government"
data$Users[which(data$Users == "Military/Commercial")] <- "Military"
data$Users[which(data$Users == "Military/Government")] <- "Military"
```

3) Purpose
"Communications/Navigation" -> "Communications"
"Communications/Technology Development" -> "Communications"
"Earth Observation/Technology Development" -> "Earth Observation"
"Navigation/Global Positioning" -> "Navigation"
"Navigation/Regional Positioning" -> "Navigation"
```{r}
data$Purpose[which(data$Purpose == "Communications/Navigation")] <- "Communications"
data$Purpose[which(data$Purpose == "Communications/Technology Development")] <- "Communications"
data$Purpose[which(data$Purpose == "Earth Observation/Technology Development")] <- "Earth Observation"
data$Purpose[which(data$Purpose == "Navigation/Global Positioning")] <- "Navigation"
data$Purpose[which(data$Purpose == "Navigation/Regional Positioning")] <- "Navigation"
```

Rendi colonne factor:
```{r}
data$'Country of Operator/Owner' <- factor(data$'Country of Operator/Owner', ordered = F)
print('Country of Operator/Owner')
table(data$'Country of Operator/Owner')

data$Users <- factor(data$Users, ordered = F)
print('Users')
table(data$Users)

data$Purpose <- factor(data$Purpose, ordered = F)
print('Purpose')
table(data$Purpose)

data$'Class of Orbit' <- factor(data$'Class of Orbit', ordered = F)
print('Class of Orbit')
table(data$'Class of Orbit')

data$Status <- factor(data$Status, ordered = F)
print('Status')
table(data$Status)
```


Ispezione del dataset:
```{r}
summary(data)
```

Cambiamo i nomi delle colonne:

"Current Official Name of Satellite" -> "Satellite Name"
"Country of Operator/Owner" -> "Country"
"Users" -> "Users"
"Purpose" -> "Purpose"
"Class of Orbit" -> "Orbit" 
"Longitude of GEO (degrees)" -> "Longitude of GEO"
"Perigee (km)" -> "Perigee"
"Apogee (km)" -> "Apogee"
"Eccentricity" -> "Eccentricity"
"Inclination (degrees)" -> "Inclination"
"Period (minutes)" -> "Period"
"Dry Mass (kg.)" -> "Mass" 
"Date of Launch" -> "Launch Date"
"Status" -> "Status"
"Date of Disposal" -> "Final Date"
"Effective Lifetime (yrs.)" -> "Effective Lifetime"
"Expected Lifetime (yrs.)" -> "Expected Lifetime"

```{r}
names(data) <- c("Satellite Name", "Country", "Users", "Purpose", "Orbit", "Longitude of GEO", "Perigee", "Apogee", "Eccentricity", "Inclination", "Period", "Mass", "Launch Date", "Status", "Final Date", "Effective Lifetime", "Expected Lifetime")
```


Impostare come data finale 17/11/2023 se lo status è attivo:
```{r}
data$'Final Date'[which(data$Status == "active")] <- as.POSIXct("2023/11/17", "UTC")
```

Calcolo effective lifetime:
```{r}
data$`Effective Lifetime` <- round(as.numeric(data$'Final Date' - data$`Launch Date`)/365, digit = 2)
```

Esportazione dataset
```{r}
# Caricare la libreria
library(openxlsx)
# Specificare il percorso del file Excel
percorso_file_excel <- "C:/Users/simon/Desktop/Università/V Anno/I Semester/Nonparametric Statistics/Project"

# Scrivere il dataframe nel file Excel
write.xlsx(data, percorso_file_excel, rowNames = FALSE)
```



